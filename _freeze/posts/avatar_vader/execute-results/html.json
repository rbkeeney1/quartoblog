{
  "hash": "96adf809c41d83ca6ea1083e779ca081",
  "result": {
    "markdown": "---\ntitle: \"Avatar VADER Sentiment Analysis\"\nauthor: \"Ryan Keeney\"\neditor: visual\nexecute:\n  freeze: true\n---\n\n\n## TidyTuesday - Avitar and Vader Sentiment Scores\n\nThe August 12, 2020 [TidyTuesday](https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-08-11) dataset presents a perfect opportunity to try out the {vader} package which can be used for native language processing.\n\nMy goal was to analyze character sentiment by breaking down each character's lines and running them through vader. Here are a few questions that I hoped to answer along the way:\n\n1.  Who are the most positive characters?\n\n2.  Who are the most negative characters?\n\n3.  Does character sentiment change over the duration of the series?\n\nI also wanted to explore a few new concepts such as the unique piping operators in {magrittr}, {tvthemes}, fonts, customizing themes, and improving my plot annotations. And while I wanted to make a word cloud in the shape of Appa - that's going to have to wait until next time.\n\n## Initial libraries and load data \n\nThe first set of libraries to load are as follows. I do load a few font and theme libraries later. But, if you want to use vader this will get you started.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidytuesdayR) # to get data quickly\nlibrary(tidyverse) # no matter how dark, there is always hope\nlibrary(magrittr) # for some more unique piping options\nlibrary(sentimentr) # for getting sentences\nlibrary(vader) # for vader sentiment scores\n```\n:::\n\n\nAs always, TidyTuesday makes it easy to get the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntuesdata <- tidytuesdayR::tt_load('2020-08-11')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Compiling #TidyTuesday Information for 2020-08-11 ----\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- There are 2 files available ---\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Starting Download ---\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tDownloading file 1 of 2: `avatar.csv`\n\tDownloading file 2 of 2: `scene_description.csv`\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Download complete ---\n```\n:::\n\n```{.r .cell-code}\navatar <- tuesdata$avatar\n```\n:::\n\n\nLet's take a quick look at what is included in this dataset. It's the script to each episode, including the writer, director, and IMDB episode - however, we're going to focus on *what* the characters are speaking.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble::tribble(\n             ~variable,      ~class,                                    ~description,\n                  \"id\",   \"integer\",                         \"Unique Row identifier\",\n                \"book\", \"character\",                                     \"Book name\",\n            \"book_num\",   \"integer\",                                   \"Book number\",\n             \"chapter\", \"character\",                                  \"Chapter name\",\n         \"chapter_num\",   \"integer\",                                  \"Chapter Name\",\n           \"character\", \"character\",                            \"Character speaking\",\n           \"full_text\", \"character\", \"Full text (scene description, character text)\",\n     \"character_words\", \"character\",                   \"Text coming from characters\",\n              \"writer\", \"character\",                                \"Writer of book\",\n            \"director\", \"character\",                           \"Director of episode\",\n         \"imdb_rating\",    \"double\",                       \"IMDB rating for episode\"\n     ) %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n|variable        |class     |description                                   |\n|:---------------|:---------|:---------------------------------------------|\n|id              |integer   |Unique Row identifier                         |\n|book            |character |Book name                                     |\n|book_num        |integer   |Book number                                   |\n|chapter         |character |Chapter name                                  |\n|chapter_num     |integer   |Chapter Name                                  |\n|character       |character |Character speaking                            |\n|full_text       |character |Full text (scene description, character text) |\n|character_words |character |Text coming from characters                   |\n|writer          |character |Writer of book                                |\n|director        |character |Director of episode                           |\n|imdb_rating     |double    |IMDB rating for episode                       |\n:::\n:::\n\n\n## Who speaks the most often?\n\nFirst, I ran a quick line of code to see who talked the most often and if I need to clean it up a bit. Looks like I\\'m going to have to remove the \\\"Scene Description\\\". Additionally, I plan on picking a subset of the characters to plot later and I want to see who speaks enough to be included.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navatar %>% group_by(character) %>% summarize(n=n())%>% arrange(-n) %>% head(20) %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n|character         |    n|\n|:-----------------|----:|\n|Scene Description | 3393|\n|Aang              | 1796|\n|Sokka             | 1639|\n|Katara            | 1437|\n|Zuko              |  776|\n|Toph              |  507|\n|Iroh              |  337|\n|Azula             |  211|\n|Jet               |  134|\n|Suki              |  114|\n|Zhao              |  107|\n|Mai               |   82|\n|Hakoda            |   77|\n|Roku              |   67|\n|Ty Lee            |   64|\n|Ozai              |   59|\n|Bumi              |   55|\n|Yue               |   53|\n|Hama              |   49|\n|Warden            |   49|\n:::\n:::\n\n\n## Data Prep\n\nThanks to Avery Robbins for dataset {appa} there isn\\'t much cleaning do be done, I only removed the \\\"Scene Description\\\". Since I\\'m also trying to get used to using the magrittr %\\<\\>% assignment-piping operator, this was a is was a good opportunity to start.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navatar_clean <- avatar \navatar_clean %<>% filter(character != \"Scene Description\") %>% select(id:character,character_words)\n```\n:::\n\n\n## VADER compound scores\n\nLuke, I am your Father. You can read more about it vader here: [PDF](https://cran.r-project.org/web/packages/vader/vader.pdf). While it is designed for social media, it also aligns pretty well with my priors about the characters.\n\n### Step 1: Sentences. Yip yip!\n\nI\\'m going to include my code I used to check my process along the way. Here, I check to make sure get_sentences() is working.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navatar_clean %>% head(5) %>% get_sentences() %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n| id|book  | book_num|chapter                | chapter_num|character |character_words                                                                                                                                                              | element_id| sentence_id|\n|--:|:-----|--------:|:----------------------|-----------:|:---------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------:|-----------:|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Water.                                                                                                                                                                       |          1|           1|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Earth.                                                                                                                                                                       |          1|           2|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Fire.                                                                                                                                                                        |          1|           3|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Air.                                                                                                                                                                         |          1|           4|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |My grandmother used to tell me stories about the old days: a time of peace when the Avatar kept balance between the Water Tribes, Earth Kingdom, Fire Nation and Air Nomads. |          1|           5|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |But that all changed when the Fire Nation attacked.                                                                                                                          |          1|           6|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Only the Avatar mastered all four elements; only he could stop the ruthless firebenders.                                                                                     |          1|           7|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |But when the world needed him most, he vanished.                                                                                                                             |          1|           8|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |A hundred years have passed, and the Fire Nation is nearing victory in the war.                                                                                              |          1|           9|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Two years ago, my father and the men of my tribe journeyed to the Earth Kingdom to help fight against the Fire Nation, leaving me and my brother to look after our tribe.    |          1|          10|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Some people believe that the Avatar was never reborn into the Air Nomads and that the cycle is broken, but I haven't lost hope.                                              |          1|          11|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |I still believe that, somehow, the Avatar will return to save the world.                                                                                                     |          1|          12|\n|  3|Water |        1|The Boy in the Iceberg |           1|Sokka     |It's not getting away from me this time.                                                                                                                                     |          2|           1|\n|  3|Water |        1|The Boy in the Iceberg |           1|Sokka     |Watch and learn, Katara.                                                                                                                                                     |          2|           2|\n|  3|Water |        1|The Boy in the Iceberg |           1|Sokka     |This is how you catch a fish.                                                                                                                                                |          2|           3|\n|  5|Water |        1|The Boy in the Iceberg |           1|Katara    |Sokka, look!                                                                                                                                                                 |          3|           1|\n|  6|Water |        1|The Boy in the Iceberg |           1|Sokka     |Sshh!                                                                                                                                                                        |          4|           1|\n|  6|Water |        1|The Boy in the Iceberg |           1|Sokka     |Katara, you're going to scare it away.                                                                                                                                       |          4|           2|\n|  6|Water |        1|The Boy in the Iceberg |           1|Sokka     |Mmmm ...                                                                                                                                                                     |          4|           3|\n|  6|Water |        1|The Boy in the Iceberg |           1|Sokka     |I can already smell it cookin'.                                                                                                                                              |          4|           4|\n|  8|Water |        1|The Boy in the Iceberg |           1|Katara    |But, Sokka!                                                                                                                                                                  |          5|           1|\n|  8|Water |        1|The Boy in the Iceberg |           1|Katara    |I caught one!                                                                                                                                                                |          5|           2|\n:::\n:::\n\n\nOkay, it works. Run it.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navatar_sentences <- avatar_clean %>% get_sentences()\n```\n:::\n\n\n### \nStep 2: Check structure and test VADER\n\nCheck the structure of avatar_sentences to setup VADER properly\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(avatar_sentences)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 18,440\nColumns: 9\n$ id              <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 5, 6, 6, ~\n$ book            <chr> \"Water\", \"Water\", \"Water\", \"Water\", \"Water\", \"Water\", ~\n$ book_num        <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~\n$ chapter         <chr> \"The Boy in the Iceberg\", \"The Boy in the Iceberg\", \"T~\n$ chapter_num     <dbl> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~\n$ character       <chr> \"Katara\", \"Katara\", \"Katara\", \"Katara\", \"Katara\", \"Kat~\n$ character_words <gt_sntnc> \"Water.\", \"Earth.\", \"Fire.\", \"Air.\", \"My grandmot~\n$ element_id      <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 3, 4, 4, ~\n$ sentence_id     <int> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 1, 2, 3, 1, 1, ~\n```\n:::\n:::\n\n\nNow for a trial run of vader_df()... notice we can pull out the the \\$compound column, I\\'ll use that when I bind the data back into the avatar_sentences dataset.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navatar_sentences$character_words %>% head(5) %>% vader_df() %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n|text                                                                                                                                                                         |word_scores                                                                                        | compound| pos|   neu|   neg| but_count|\n|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------------------------------|--------:|---:|-----:|-----:|---------:|\n|Water.                                                                                                                                                                       |{0}                                                                                                |    0.000| 0.0| 1.000| 0.000|         0|\n|Earth.                                                                                                                                                                       |{0}                                                                                                |    0.000| 0.0| 1.000| 0.000|         0|\n|Fire.                                                                                                                                                                        |{-1.4}                                                                                             |   -0.340| 0.0| 0.000| 1.000|         0|\n|Air.                                                                                                                                                                         |{0}                                                                                                |    0.000| 0.0| 1.000| 0.000|         0|\n|My grandmother used to tell me stories about the old days: a time of peace when the Avatar kept balance between the Water Tribes, Earth Kingdom, Fire Nation and Air Nomads. |{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2.5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1.4, 0, 0, 0, 0} |    0.273| 0.1| 0.831| 0.069|         0|\n:::\n:::\n\n\n### Step 3: Cross fingers, Run Vader, Make Coffee\n\nRunning it on all the sentences takes a bit of time. Go make coffee. Check Twitter. Pet the dog.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nptm <- proc.time() # Start the clock!\nvader_comp <- avatar_sentences$character_words %>% vader_df() %>% select(compound)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in sentiments[i] <- senti_valence(wpe, i, item): number of items to\nreplace is not a multiple of replacement length\n```\n:::\n\n```{.r .cell-code}\nproc.time() - ptm # Calc time\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   user  system elapsed \n 101.12   28.54  154.94 \n```\n:::\n\n```{.r .cell-code}\n#note, set \"cache=TRUE\" and save some time!\n```\n:::\n\n\nInspect the results\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# check it visually\nvader_comp %>% arrange(-compound) %>% head(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  compound\n1    0.965\n2    0.944\n3    0.939\n4    0.931\n5    0.927\n```\n:::\n\n```{.r .cell-code}\nvader_comp %>% arrange(-compound) %>% tail(5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      compound\n18436   -0.916\n18437   -0.926\n18438   -0.927\n18439   -0.947\n18440   -0.951\n```\n:::\n\n```{.r .cell-code}\n# Any failures?\nvader_comp %>% filter(is.na(compound)) # no NAs\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] compound\n<0 rows> (or 0-length row.names)\n```\n:::\n\n```{.r .cell-code}\nvader_comp %>% filter(is.nan(compound)) # no NaNs\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] compound\n<0 rows> (or 0-length row.names)\n```\n:::\n\n```{.r .cell-code}\n# check dims before binding\ndim(vader_comp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 18440     1\n```\n:::\n\n```{.r .cell-code}\ndim(avatar_sentences)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 18440     9\n```\n:::\n:::\n\n\n### Step 4: Bind\n\nTime to add the compound vader score back into our dataset and look at the top 10 instances (again). I could have done this code much more condensed; but, I kept it separated so you follow the process.\n\n\n::: {.cell}\n\n```{.r .cell-code}\navatar_sentences %<>% cbind(vader_comp)\navatar_sentences %>% head(5) %>% knitr::kable()\n```\n\n::: {.cell-output-display}\n| id|book  | book_num|chapter                | chapter_num|character |character_words                                                                                                                                                              | element_id| sentence_id| compound|\n|--:|:-----|--------:|:----------------------|-----------:|:---------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------:|-----------:|--------:|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Water.                                                                                                                                                                       |          1|           1|    0.000|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Earth.                                                                                                                                                                       |          1|           2|    0.000|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Fire.                                                                                                                                                                        |          1|           3|   -0.340|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |Air.                                                                                                                                                                         |          1|           4|    0.000|\n|  1|Water |        1|The Boy in the Iceberg |           1|Katara    |My grandmother used to tell me stories about the old days: a time of peace when the Avatar kept balance between the Water Tribes, Earth Kingdom, Fire Nation and Air Nomads. |          1|           5|    0.273|\n:::\n:::\n\n\nLooks good!\n\n## Plot Prep\n\nAs I prepare to make some plots there are few things I'd like to have available:\n\n1.  An \"episode\" number so I can sort and chart books 1-3 because chapter numbers are repeated within each book\n\n2.  Reordered characters - based on their median vader score so that the plots look nice.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# create new sequence number for each chapter, because chapter number is repeated within each book\nunique(avatar_sentences$chapter_num)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21\n```\n:::\n\n```{.r .cell-code}\n# add episode_num\navatar_sentences %<>% \n     mutate(episode_num = case_when(\n          book_num == 1 ~ chapter_num,\n          book_num == 2 ~ chapter_num + 21,\n          book_num == 3 ~ chapter_num + 42\n     ))\n\n# add in character vader compound median to sort\navatar_sentences %<>% \n     group_by(character) %>% \n     mutate(char_vader_mean = median(compound[compound != 0])) %>% \n     ungroup() %>% \n     mutate(character = fct_reorder(character, -char_vader_mean))\n```\n:::\n\n\n## \nFonts and Themes\n\nI\\'m very new to themes and fonts, so not everything worked as well as I\\'d like. I ended up using some fonts from [Google Fonts](https://fonts.google.com/) referenced this excellent [blog post](https://cedricscherer.netlify.app/2019/05/17/the-evolution-of-a-ggplot-ep.-1/) by CÃ©dric Scherer.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tvthemes) # great ggplot themes and color palettes\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'tvthemes' was built under R version 4.1.3\n```\n:::\n\n```{.r .cell-code}\nlibrary(showtext) # use fonts from google\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'showtext' was built under R version 4.1.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: sysfonts\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'sysfonts' was built under R version 4.1.1\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: showtextdb\n```\n:::\n\n```{.r .cell-code}\nlibrary(extrafont) # use computer fonts\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'extrafont' was built under R version 4.1.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nRegistering fonts with R\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'extrafont'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nThe following object is masked from 'package:showtextdb':\n\n    font_install\n```\n:::\n\n```{.r .cell-code}\n#font_import()\nimport_avatar() # import \"Slayer\" font, will need to loadfonts() to access\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nYou should install these fonts on your system directly. The files are located in [C:/Users/keene/Documents/R/win-library/4.1/tvthemes/fonts/Slayer]\n```\n:::\n\n```{.r .cell-code}\nloadfonts(device = \"win\") # Load fonts, can take a minute\n\n# with {showtext}, you can load directly from google fonts\nfont_add_google(\"Indie Flower\", \"Indie Flower\")\n\n# Check the current search path for fonts\n#font_paths() \n\n# List available font files in the search path\n#font_files() \n\n# syntax: font_add(family = \"<family_name>\", regular = \"/path/to/font/file\")\n#font_add(\"Palatino\", \"pala.ttf\")\n\n#font_families()\n\nshowtext_auto()\n```\n:::\n\n\n## ggplot \"Bending\"\n\nCode for my primary plot, with comments.\n\nI should also note that I\\'m still working on developing my plot scaling abilities for rMarkdown, so this code might output the plots with small text for you if you scale up a too high. I often develop and save the plot (the code below), then load the image into the markdown.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- avatar_sentences %>% \n     filter(character %in% c(\"Aang\",\"Sokka\",\"Katara\",\"Zuko\",\"Toph\",\"Iroh\",\"Azula\",\"Jet\",\"Suki\",\"Mai\",\"Ty Lee\")) %>% # only wanted primary characters\n     filter(compound != 0) %>% # pulled out 0 scores, not sure if this is good process or not, but it helps with the viz and tell the story better.\n     ggplot(aes(x = character, y = compound, color = character)) +\n     geom_hline(aes(yintercept = 0), color = \"black\", size = 0.6) + # add line at zero (bc I pull all other lines out in the theme)\n     geom_jitter(position = position_jitter(seed = 2020,width = 0.25), size = 1, alpha = 0.15) + # add a jitter\n     #geom_boxplot(color = \"black\",stat = \"boxplot\",outlier.alpha = 0,fill=NA) + #pulled this out, decided to use the lollipops\n     geom_segment(aes(x = character, xend = character, y = 0, yend = char_vader_mean), size = 1.0,color = \"black\") + # line to zero from median\n     stat_summary(fun = stats::median, geom = \"point\", size = 5, color = \"black\") + # make a slightly bigger dot\n     stat_summary(fun = stats::median, geom = \"point\", size = 4) + # fill it in, I think i could have done this in 1x line with fill/color, but I couldn't figure it out quickly.\n     labs(\n          title = \"Water. Earth. Fire. Air. Vader.\",\n          subtitle = \"Analyzing The Setiment of Avatar's Primary Characters With Compound VADER Scores\",\n          y = \"Compound Vader Scores\",\n          x = NULL,\n          caption = \"Data {appa} by Avery Robbins \\nTidyTuesday 2020-08-11\\n@rbkeeney\"\n          ) +\n     annotate(\"text\", x = 8, y = 1, family = \"Indie Flower\", color = \"gray20\",lineheight = 0.5, size = 6,\n              label = \"Every circle represents a sentence spoken by the character.\\nA higher score correlates to positive sentiment, zero is neutral\"\n              ) +\n     annotate(\"text\", x = 1, y = 0.8, family = \"Indie Flower\", color = \"gray20\", lineheight = 0.5, size = 6,\n              label = \"Ty Lee and Iroh\\nwere the most\\npostive characters\"\n              ) +\n     annotate(\"text\", x = 1, y = -0.4, family = \"Indie Flower\", color = \"gray20\",lineheight = 0.5, size = 6,\n              label = \"All sentences \\nwith a compound \\nscore of 0 have \\nbeen removed\"\n              ) +\n     annotate(\"text\", x = 11, y = -0.8, family = \"Indie Flower\", color = \"gray20\",lineheight = 0.5, size = 6,\n              label = \"Mai was the only\\ncharacter with a \\nnegataive median \\nsentiment\"\n              ) + \n     theme_avatar(\n          title.font = \"Indie Flower\", # wanted to use slayer, but issues getting loaded.\n          text.font = \"Indie Flower\",\n          title.size = 36,\n          subtitle.size = 24\n     ) +\n     theme(\n          axis.title = element_text(size=24),\n          axis.text = element_text(size=24),\n          legend.position = \"none\", # remove legend\n          plot.caption = element_text(size = 16, color = \"grey20\",lineheight = 0.5), #update caption\n          panel.grid.major = element_blank(), # remove plot grids\n          panel.grid.minor = element_blank(), # remove plot grids\n          panel.border = element_rect(colour = \"black\",fill = NA), # box the plot. I like it. Fill = NA ~ no fill.\n          axis.line = element_line(colour = \"black\"),\n          )\n\n# match arrows to annotations... takes time, go arrow by arrow.\np1_arrows <- tibble(\n     x1 = c(1.0, 1.0, 8.5,1,10.6),\n     x2 = c(1.0, 2.0, 8.3,1,10.9),\n     y1 = c(0.67, 0.67, 0.9,-.25,-.65), \n     y2 = c(0.45, 0.38, 0.76,-.05,-.1)\n     )\n\n# combine into final plot\np1_final <- p1 + geom_curve(\n     data = p1_arrows, aes(x = x1, y = y1, xend = x2, yend = y2),\n     arrow = arrow(length = unit(0.07, \"inch\")), size = 0.4,\n     color = \"gray40\", curvature = -0.2\n     )\n\n# To create better pictures for the markdown (1) save it, and (2) then call it in markdown text with: ![alt text here](path-to-image-here)\n# for referecne, this is what roughly outputs on the screen, moving up dpi will shrink the text...\n# ggsave(p1_final, filename = \"figs/Rplot1.png\", dpi = 96, type = \"cairo\", width = 7, height = 5, units = \"in\")\n# dpi: 72-96 for web... 300-400 for high res stuff\n\n# save high res (uncomment)\n#ggsave(p1_final, filename = \"figs/Rplot1.png\", dpi = 300, type = \"cairo\", width = 7, height = 5, units = \"in\")\n\n# open high res, for iteration (comment out once done)\n# img_1 <- magick::image_read('figs/Rplot1.png')\n# print(img_1)\n```\n:::\n\n\n![](images/avatar_p1.png)\n\nFor the second plot, we use facet_wrap() to show how a few characters compound vadar scores over the duration fo the series.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np2 <- avatar_sentences %>% \n     filter(character %in% c(\"Aang\",\"Sokka\",\"Katara\",\"Zuko\",\"Toph\",\"Iroh\")) %>% \n     filter(compound != 0) %>% \n     #filter(book == \"Water\") %>% \n     ggplot(aes(x = episode_num, y = compound, color = character)) +\n     #geom_point(alpha = 0.6) +\n     #geom_jitter() +\n     geom_smooth(method = loess, se = F, formula = y ~ x) +\n     facet_wrap(~ character) + \n     coord_cartesian(ylim = c(0,0.3)) +\n     labs(\n          title = \"Water. Earth. Fire. Air. Vader.\",\n          subtitle = \"Analyzing The Change in Setiment Avatar's Primary Characters With Compound VADER Scores Over The Duration Of The Series\",\n          y = \"Compound VADER Scores\",\n          x = \"Nth Episode\",\n          caption = \"Data {appa} by Avery Robbins \\nTidyTuesday 2020-08-11\\n@rbkeeney\"\n          ) +\n     theme_avatar(\n          title.font = \"Indie Flower\",\n          title.size = 36,\n          text.font = \"Indie Flower\",\n          subtitle.size = 24,\n     ) +\n     theme(\n          text = element_text(size = 28, lineheight = 0.5),\n          axis.title = element_text(size=24),\n          axis.text = element_text(size=24),\n          legend.position = \"none\",\n          plot.caption = element_text(color = \"grey20\", size = 16),\n          panel.grid.major = element_blank(), \n          panel.grid.minor = element_blank(),\n          panel.border = element_rect(colour = \"black\",fill = NA),\n          axis.line = element_line(colour = \"black\")\n          )\n\n# uncomment to save\n#ggsave(p2, filename = \"figs/Rplot2.png\", dpi = 300, type = \"cairo\", width = 7, height = 5, units = \"in\") \n# open high res, for iteration (comment out once done)\n#img_2 <- magick::image_read('figs/Rplot2.png')\n#print(img_2)\n```\n:::\n\n\n![](images/avatar_p2.png)\n\nThat wraps it up! Cheers, Ryan\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}